{
  "description": "Complete the Delta Lake commands for time travel, optimization, and change data capture.",
  "expectedOutput": "When completed correctly, this code will:\n1. Query the patients table as it existed 24 hours ago (time travel)\n2. Restore the table to version 42\n3. Compact small files with OPTIMIZE\n4. Z-ORDER by patient_id and admission_date for faster filtering\n5. Clean up files older than 7 days (168 hours) with VACUUM\n6. Enable Change Data Feed to track row-level changes",
  "codeTemplate": "-- Time travel: query table as it was 24 hours ago\nSELECT * FROM patients __BLANK_0__ AS OF '2024-01-14 10:00:00';\n\n-- Restore table to previous version\n__BLANK_1__ TABLE patients TO VERSION AS OF 42;\n\n-- Compact small files\n__BLANK_2__ patients;\n\n-- Z-ORDER by frequently filtered columns\nOPTIMIZE patients __BLANK_3__ BY (patient_id, admission_date);\n\n-- Clean up old files (keep 7 days)\n__BLANK_4__ patients RETAIN __BLANK_5__ HOURS;\n\n-- Enable Change Data Feed\nALTER TABLE patients SET TBLPROPERTIES (\n  '__BLANK_6__' = 'true'\n);",
  "blanks": [
    {
      "id": 0,
      "options": [
        "TIMESTAMP",
        "VERSION",
        "AS OF",
        "HISTORY"
      ],
      "correctAnswer": "TIMESTAMP"
    },
    {
      "id": 1,
      "options": [
        "RESTORE",
        "ROLLBACK",
        "REVERT",
        "UNDO"
      ],
      "correctAnswer": "RESTORE"
    },
    {
      "id": 2,
      "options": [
        "OPTIMIZE",
        "COMPACT",
        "DEFRAG",
        "REBUILD"
      ],
      "correctAnswer": "OPTIMIZE"
    },
    {
      "id": 3,
      "options": [
        "ZORDER",
        "CLUSTER",
        "SORT",
        "INDEX"
      ],
      "correctAnswer": "ZORDER"
    },
    {
      "id": 4,
      "options": [
        "VACUUM",
        "CLEAN",
        "PURGE",
        "DELETE"
      ],
      "correctAnswer": "VACUUM"
    },
    {
      "id": 5,
      "options": [
        "168",
        "24",
        "720",
        "48"
      ],
      "correctAnswer": "168"
    },
    {
      "id": 6,
      "options": [
        "delta.enableChangeDataFeed",
        "delta.enableCDC",
        "delta.changeDataFeed",
        "delta.trackChanges"
      ],
      "correctAnswer": "delta.enableChangeDataFeed"
    }
  ],
  "hints": [
    "TIMESTAMP AS OF queries historical data by date/time",
    "RESTORE TABLE reverts to a previous version",
    "168 hours = 7 days (default VACUUM retention period)",
    "delta.enableChangeDataFeed is the table property for CDC"
  ],
  "learnings": [
    "VERSION AS OF reads historical table versions",
    "OPTIMIZE ZORDER BY colocates related data",
    "VACUUM removes files older than retention period",
    "MERGE handles upsert (update + insert) operations",
    "DESCRIBE HISTORY shows the transaction log"
  ]
}